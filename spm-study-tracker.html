<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPM Study Tracker - Master Your Studies</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.1/dist/umd/lucide.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #0a0a0a; 
            color: #e0e0e0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .glassmorphism {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 2s infinite; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;
        const { AreaChart, Area, BarChart, Bar, PieChart, Pie, Cell, LineChart, Line, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // Firebase Configuration - REPLACE WITH YOUR OWN CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase (will work in local storage mode if not configured)
        let db, auth;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
        } catch (error) {
            console.log("Running in local mode - Firebase not configured");
        }

        // SPM Subjects Configuration
        const SPM_SUBJECTS = [
            { id: 'bm', name: 'Bahasa Melayu', color: '#FF6B6B', icon: 'üìö' },
            { id: 'bi', name: 'English', color: '#4ECDC4', icon: 'üî§' },
            { id: 'math', name: 'Mathematics', color: '#45B7D1', icon: 'üî¢' },
            { id: 'addmath', name: 'Additional Mathematics', color: '#96CEB4', icon: 'üìê' },
            { id: 'physics', name: 'Physics', color: '#FFEAA7', icon: '‚öõÔ∏è' },
            { id: 'chemistry', name: 'Chemistry', color: '#DDA0DD', icon: 'üß™' },
            { id: 'biology', name: 'Biology', color: '#98D8C8', icon: 'üß¨' },
            { id: 'history', name: 'History', color: '#F7B731', icon: 'üìú' },
            { id: 'moral', name: 'Moral/Islamic Studies', color: '#A29BFE', icon: 'üïäÔ∏è' }
        ];

        // Spaced Repetition Algorithm (Anki-style SM-2)
        class SpacedRepetition {
            static calculateNextReview(difficulty, consecutiveCorrect, previousInterval = 1) {
                const efactor = Math.max(1.3, 2.5 - 0.15 * difficulty);
                let interval;
                
                if (consecutiveCorrect === 0) {
                    interval = 1; // Review tomorrow
                } else if (consecutiveCorrect === 1) {
                    interval = 1;
                } else if (consecutiveCorrect === 2) {
                    interval = 3;
                } else {
                    interval = Math.round(previousInterval * efactor);
                }
                
                return {
                    interval,
                    nextReviewDate: new Date(Date.now() + interval * 24 * 60 * 60 * 1000),
                    efactor
                };
            }

            static getReviewColor(daysUntilReview) {
                if (daysUntilReview < 0) return '#FF4757'; // Overdue
                if (daysUntilReview === 0) return '#FFA502'; // Due today
                if (daysUntilReview <= 2) return '#FFEAA7'; // Due soon
                return '#6C5CE7'; // Future
            }
        }

        // Local Storage Manager (fallback when Firebase not configured)
        class LocalStorageManager {
            static save(key, data) {
                localStorage.setItem(key, JSON.stringify(data));
            }

            static load(key, defaultValue = null) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            }

            static remove(key) {
                localStorage.removeItem(key);
            }
        }

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [activeView, setActiveView] = useState('dashboard');
            const [studySessions, setStudySessions] = useState([]);
            const [topics, setTopics] = useState([]);
            const [currentSession, setCurrentSession] = useState(null);
            const [timerSeconds, setTimerSeconds] = useState(0);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const [dailyGoal] = useState(360); // 6 hours in minutes
            const [streak, setStreak] = useState(0);
            const [medals, setMedals] = useState({ gold: 0, silver: 0, bronze: 0 });
            const [sharePrice, setSharePrice] = useState(0);
            const [selectedSubject, setSelectedSubject] = useState(null);
            const [pomodoroSettings] = useState({ workTime: 25, breakTime: 5 });
            const [showAddTopic, setShowAddTopic] = useState(false);

            // Load data on mount
            useEffect(() => {
                loadUserData();
            }, []);

            // Timer effect
            useEffect(() => {
                let interval;
                if (isTimerRunning && currentSession) {
                    interval = setInterval(() => {
                        setTimerSeconds(prev => prev + 1);
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isTimerRunning, currentSession]);

            // Calculate stats effect
            useEffect(() => {
                calculateStreakAndMedals();
                calculateSharePrice();
            }, [studySessions]);

            const loadUserData = async () => {
                // Try to load from Firebase or fallback to localStorage
                try {
                    if (db && auth.currentUser) {
                        const userData = await db.collection('users').doc(auth.currentUser.uid).get();
                        if (userData.exists) {
                            const data = userData.data();
                            setStudySessions(data.sessions || []);
                            setTopics(data.topics || []);
                            setStreak(data.streak || 0);
                            setMedals(data.medals || { gold: 0, silver: 0, bronze: 0 });
                            setSharePrice(data.sharePrice || 0);
                        }
                    } else {
                        // Load from localStorage
                        setStudySessions(LocalStorageManager.load('studySessions', []));
                        setTopics(LocalStorageManager.load('topics', []));
                        setStreak(LocalStorageManager.load('streak', 0));
                        setMedals(LocalStorageManager.load('medals', { gold: 0, silver: 0, bronze: 0 }));
                        setSharePrice(LocalStorageManager.load('sharePrice', 0));
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            };

            const saveUserData = async () => {
                const data = {
                    sessions: studySessions,
                    topics,
                    streak,
                    medals,
                    sharePrice
                };

                try {
                    if (db && auth.currentUser) {
                        await db.collection('users').doc(auth.currentUser.uid).set(data);
                    } else {
                        // Save to localStorage
                        LocalStorageManager.save('studySessions', studySessions);
                        LocalStorageManager.save('topics', topics);
                        LocalStorageManager.save('streak', streak);
                        LocalStorageManager.save('medals', medals);
                        LocalStorageManager.save('sharePrice', sharePrice);
                    }
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            };

            const startSession = (subject) => {
                const session = {
                    id: Date.now().toString(),
                    subject,
                    startTime: new Date().toISOString(),
                    duration: 0,
                    date: new Date().toLocaleDateString()
                };
                setCurrentSession(session);
                setTimerSeconds(0);
                setIsTimerRunning(true);
            };

            const stopSession = () => {
                if (currentSession) {
                    const finalSession = {
                        ...currentSession,
                        duration: timerSeconds,
                        endTime: new Date().toISOString()
                    };
                    setStudySessions([...studySessions, finalSession]);
                    setCurrentSession(null);
                    setIsTimerRunning(false);
                    setTimerSeconds(0);
                    saveUserData();
                }
            };

            const addTopic = (topic) => {
                const newTopic = {
                    id: Date.now().toString(),
                    ...topic,
                    createdAt: new Date().toISOString(),
                    reviews: [],
                    nextReview: new Date().toISOString(),
                    interval: 1,
                    efactor: 2.5,
                    consecutiveCorrect: 0
                };
                setTopics([...topics, newTopic]);
                setShowAddTopic(false);
                saveUserData();
            };

            const reviewTopic = (topicId, difficulty) => {
                const topic = topics.find(t => t.id === topicId);
                if (!topic) return;

                const review = {
                    date: new Date().toISOString(),
                    difficulty,
                    correct: difficulty <= 3
                };

                const consecutiveCorrect = difficulty <= 3 ? topic.consecutiveCorrect + 1 : 0;
                const { interval, nextReviewDate, efactor } = SpacedRepetition.calculateNextReview(
                    difficulty, 
                    consecutiveCorrect, 
                    topic.interval
                );

                const updatedTopic = {
                    ...topic,
                    reviews: [...topic.reviews, review],
                    nextReview: nextReviewDate.toISOString(),
                    interval,
                    efactor,
                    consecutiveCorrect
                };

                setTopics(topics.map(t => t.id === topicId ? updatedTopic : t));
                saveUserData();
            };

            const calculateStreakAndMedals = () => {
                const today = new Date().toLocaleDateString();
                const todaySessions = studySessions.filter(s => s.date === today);
                const todayMinutes = todaySessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);

                // Calculate medals
                const newMedals = { ...medals };
                if (todayMinutes >= 300) newMedals.gold++;
                else if (todayMinutes >= 240) newMedals.silver++;
                else if (todayMinutes >= 180) newMedals.bronze++;

                setMedals(newMedals);

                // Calculate streak
                let currentStreak = 0;
                const sortedDates = [...new Set(studySessions.map(s => s.date))].sort().reverse();
                
                for (let i = 0; i < sortedDates.length; i++) {
                    const date = new Date(sortedDates[i]);
                    const expectedDate = new Date();
                    expectedDate.setDate(expectedDate.getDate() - i);
                    
                    if (date.toDateString() === expectedDate.toDateString()) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
                
                setStreak(currentStreak);
            };

            const calculateSharePrice = () => {
                let price = 0;
                const sessionsByDate = {};
                
                studySessions.forEach(session => {
                    if (!sessionsByDate[session.date]) {
                        sessionsByDate[session.date] = 0;
                    }
                    sessionsByDate[session.date] += Math.floor(session.duration / 60);
                });

                Object.entries(sessionsByDate).forEach(([date, minutes]) => {
                    const difference = minutes - dailyGoal;
                    price += difference;
                });

                setSharePrice(price);
            };

            const getAIRecommendation = () => {
                // Smart recommendation algorithm
                const now = new Date();
                const todayTopics = topics.filter(t => {
                    const reviewDate = new Date(t.nextReview);
                    return reviewDate.toDateString() === now.toDateString();
                });

                const overdueTopics = topics.filter(t => {
                    const reviewDate = new Date(t.nextReview);
                    return reviewDate < now && reviewDate.toDateString() !== now.toDateString();
                });

                // Analyze weak subjects
                const subjectStats = {};
                SPM_SUBJECTS.forEach(subject => {
                    const sessions = studySessions.filter(s => s.subject === subject.id);
                    const totalMinutes = sessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                    subjectStats[subject.id] = totalMinutes;
                });

                const weakestSubject = Object.entries(subjectStats)
                    .sort((a, b) => a[1] - b[1])[0];

                if (overdueTopics.length > 0) {
                    return {
                        type: 'urgent',
                        message: `You have ${overdueTopics.length} overdue topics!`,
                        subject: overdueTopics[0].subject,
                        topic: overdueTopics[0]
                    };
                } else if (todayTopics.length > 0) {
                    return {
                        type: 'review',
                        message: `Time to review: ${todayTopics[0].name}`,
                        subject: todayTopics[0].subject,
                        topic: todayTopics[0]
                    };
                } else if (weakestSubject) {
                    const subject = SPM_SUBJECTS.find(s => s.id === weakestSubject[0]);
                    return {
                        type: 'balance',
                        message: `Focus on ${subject.name} - it needs more attention!`,
                        subject: subject.id,
                        topic: null
                    };
                }

                return {
                    type: 'general',
                    message: 'Great job! Keep up the consistent studying!',
                    subject: null,
                    topic: null
                };
            };

            const formatTime = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const getTodayProgress = () => {
                const today = new Date().toLocaleDateString();
                const todaySessions = studySessions.filter(s => s.date === today);
                const todayMinutes = todaySessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                return {
                    minutes: todayMinutes,
                    percentage: Math.min(100, (todayMinutes / dailyGoal) * 100)
                };
            };

            const recommendation = getAIRecommendation();
            const todayProgress = getTodayProgress();

            // View Components
            const DashboardView = () => (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {/* Main Stats */}
                    <div className="lg:col-span-2 space-y-6">
                        {/* AI Recommendation */}
                        <div className="glassmorphism rounded-2xl p-6 glow">
                            <div className="flex items-center gap-3 mb-4">
                                <span className="text-2xl">ü§ñ</span>
                                <h3 className="text-xl font-semibold">AI Study Recommendation</h3>
                            </div>
                            <p className="text-lg mb-4">{recommendation.message}</p>
                            {recommendation.subject && (
                                <button 
                                    onClick={() => startSession(recommendation.subject)}
                                    className="px-6 py-3 bg-violet-600 hover:bg-violet-700 rounded-xl transition-colors"
                                >
                                    Start Studying Now
                                </button>
                            )}
                        </div>

                        {/* Progress Pills */}
                        <div className="grid grid-cols-3 gap-4">
                            <div className="glassmorphism rounded-xl p-4">
                                <div className="text-sm text-gray-400 mb-2">Daily Progress</div>
                                <div className="relative h-2 bg-gray-800 rounded-full overflow-hidden">
                                    <div 
                                        className="absolute h-full bg-gradient-to-r from-violet-500 to-purple-500 transition-all"
                                        style={{ width: `${todayProgress.percentage}%` }}
                                    />
                                </div>
                                <div className="mt-2 text-lg font-semibold">
                                    {todayProgress.minutes} / {dailyGoal} min
                                </div>
                            </div>
                            
                            <div className="glassmorphism rounded-xl p-4">
                                <div className="text-sm text-gray-400 mb-2">Current Streak</div>
                                <div className="text-3xl font-bold text-orange-500">
                                    üî• {streak}
                                </div>
                            </div>
                            
                            <div className="glassmorphism rounded-xl p-4">
                                <div className="text-sm text-gray-400 mb-2">Share Price</div>
                                <div className="text-2xl font-bold">
                                    <span className={sharePrice >= 0 ? 'text-green-500' : 'text-red-500'}>
                                        {sharePrice >= 0 ? 'üìà' : 'üìâ'} {sharePrice > 0 ? '+' : ''}{sharePrice}
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* Subject Grid */}
                        <div className="glassmorphism rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Quick Start Session</h3>
                            <div className="grid grid-cols-3 gap-3">
                                {SPM_SUBJECTS.map(subject => {
                                    const isActive = currentSession?.subject === subject.id;
                                    return (
                                        <button
                                            key={subject.id}
                                            onClick={() => !isActive ? startSession(subject.id) : stopSession()}
                                            className={`p-4 rounded-xl transition-all ${
                                                isActive 
                                                    ? 'bg-violet-600 scale-105' 
                                                    : 'bg-gray-800 hover:bg-gray-700'
                                            }`}
                                            style={{ 
                                                borderLeft: `4px solid ${subject.color}`,
                                                boxShadow: isActive ? `0 0 20px ${subject.color}40` : 'none'
                                            }}
                                        >
                                            <div className="text-2xl mb-2">{subject.icon}</div>
                                            <div className="text-sm font-medium">{subject.name}</div>
                                            {isActive && (
                                                <div className="text-xs mt-2 font-mono">
                                                    {formatTime(timerSeconds)}
                                                </div>
                                            )}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Recent Sessions Chart */}
                        <div className="glassmorphism rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Weekly Overview</h3>
                            <ResponsiveContainer width="100%" height={200}>
                                <AreaChart data={getWeeklyData()}>
                                    <defs>
                                        <linearGradient id="colorGradient" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#8B5CF6" stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor="#8B5CF6" stopOpacity={0.1}/>
                                        </linearGradient>
                                    </defs>
                                    <XAxis dataKey="day" stroke="#666" />
                                    <YAxis stroke="#666" />
                                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                    <Tooltip 
                                        contentStyle={{ 
                                            backgroundColor: '#1a1a1a', 
                                            border: '1px solid #333',
                                            borderRadius: '8px'
                                        }} 
                                    />
                                    <Area 
                                        type="monotone" 
                                        dataKey="minutes" 
                                        stroke="#8B5CF6" 
                                        fill="url(#colorGradient)" 
                                        strokeWidth={2}
                                    />
                                </AreaChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Right Sidebar */}
                    <div className="space-y-6">
                        {/* Timer */}
                        {currentSession && (
                            <div className="glassmorphism rounded-2xl p-6 glow">
                                <div className="text-center">
                                    <div className="text-sm text-gray-400 mb-2">Currently Studying</div>
                                    <div className="text-xl font-semibold mb-4">
                                        {SPM_SUBJECTS.find(s => s.id === currentSession.subject)?.name}
                                    </div>
                                    <div className="text-5xl font-mono font-bold mb-6">
                                        {formatTime(timerSeconds)}
                                    </div>
                                    <button 
                                        onClick={stopSession}
                                        className="w-full py-3 bg-red-600 hover:bg-red-700 rounded-xl transition-colors"
                                    >
                                        Stop Session
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Medals */}
                        <div className="glassmorphism rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Medal Collection</h3>
                            <div className="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <div className="text-3xl mb-2">ü•á</div>
                                    <div className="text-2xl font-bold text-yellow-500">{medals.gold}</div>
                                </div>
                                <div>
                                    <div className="text-3xl mb-2">ü•à</div>
                                    <div className="text-2xl font-bold text-gray-400">{medals.silver}</div>
                                </div>
                                <div>
                                    <div className="text-3xl mb-2">ü•â</div>
                                    <div className="text-2xl font-bold text-orange-600">{medals.bronze}</div>
                                </div>
                            </div>
                        </div>

                        {/* Due Reviews */}
                        <div className="glassmorphism rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Due Reviews</h3>
                            <div className="space-y-2 max-h-64 overflow-y-auto scrollbar-hide">
                                {topics
                                    .filter(t => new Date(t.nextReview) <= new Date())
                                    .sort((a, b) => new Date(a.nextReview) - new Date(b.nextReview))
                                    .slice(0, 5)
                                    .map(topic => (
                                        <div 
                                            key={topic.id}
                                            className="p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700"
                                            onClick={() => setActiveView('spacedRepetition')}
                                        >
                                            <div className="text-sm font-medium">{topic.name}</div>
                                            <div className="text-xs text-gray-400">
                                                {SPM_SUBJECTS.find(s => s.id === topic.subject)?.name}
                                            </div>
                                        </div>
                                    ))
                                }
                                {topics.filter(t => new Date(t.nextReview) <= new Date()).length === 0 && (
                                    <div className="text-gray-500 text-center py-4">
                                        No reviews due! üéâ
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const SpacedRepetitionView = () => (
                <div className="max-w-6xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold">Spaced Repetition</h2>
                        <button 
                            onClick={() => setShowAddTopic(true)}
                            className="px-6 py-2 bg-violet-600 hover:bg-violet-700 rounded-lg transition-colors"
                        >
                            Add Topic
                        </button>
                    </div>

                    {/* Topic Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {topics.map(topic => {
                            const daysUntil = Math.ceil((new Date(topic.nextReview) - new Date()) / (1000 * 60 * 60 * 24));
                            const reviewColor = SpacedRepetition.getReviewColor(daysUntil);
                            
                            return (
                                <div 
                                    key={topic.id}
                                    className="glassmorphism rounded-xl p-4"
                                    style={{ borderLeft: `4px solid ${reviewColor}` }}
                                >
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className="font-semibold">{topic.name}</h3>
                                            <div className="text-sm text-gray-400">
                                                {SPM_SUBJECTS.find(s => s.id === topic.subject)?.name}
                                            </div>
                                        </div>
                                        <div className="text-2xl">
                                            {SPM_SUBJECTS.find(s => s.id === topic.subject)?.icon}
                                        </div>
                                    </div>
                                    
                                    <div className="text-sm text-gray-400 mb-3">
                                        {daysUntil < 0 
                                            ? `Overdue by ${Math.abs(daysUntil)} days!` 
                                            : daysUntil === 0 
                                            ? 'Due today!' 
                                            : `Due in ${daysUntil} days`}
                                    </div>

                                    {daysUntil <= 0 && (
                                        <div className="flex gap-2 mt-3">
                                            <button 
                                                onClick={() => reviewTopic(topic.id, 1)}
                                                className="flex-1 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm"
                                            >
                                                Easy
                                            </button>
                                            <button 
                                                onClick={() => reviewTopic(topic.id, 3)}
                                                className="flex-1 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-sm"
                                            >
                                                Good
                                            </button>
                                            <button 
                                                onClick={() => reviewTopic(topic.id, 5)}
                                                className="flex-1 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"
                                            >
                                                Hard
                                            </button>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                    {/* Add Topic Modal */}
                    {showAddTopic && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="glassmorphism rounded-2xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-semibold mb-4">Add New Topic</h3>
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const formData = new FormData(e.target);
                                    addTopic({
                                        name: formData.get('name'),
                                        subject: formData.get('subject'),
                                        difficulty: parseInt(formData.get('difficulty'))
                                    });
                                }}>
                                    <input 
                                        name="name"
                                        type="text" 
                                        placeholder="Topic name"
                                        className="w-full p-3 bg-gray-800 rounded-lg mb-4"
                                        required
                                    />
                                    <select 
                                        name="subject"
                                        className="w-full p-3 bg-gray-800 rounded-lg mb-4"
                                        required
                                    >
                                        <option value="">Select Subject</option>
                                        {SPM_SUBJECTS.map(s => (
                                            <option key={s.id} value={s.id}>{s.name}</option>
                                        ))}
                                    </select>
                                    <select 
                                        name="difficulty"
                                        className="w-full p-3 bg-gray-800 rounded-lg mb-4"
                                        required
                                    >
                                        <option value="1">Easy</option>
                                        <option value="3">Medium</option>
                                        <option value="5">Hard</option>
                                    </select>
                                    <div className="flex gap-3">
                                        <button 
                                            type="button"
                                            onClick={() => setShowAddTopic(false)}
                                            className="flex-1 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg"
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            type="submit"
                                            className="flex-1 py-3 bg-violet-600 hover:bg-violet-700 rounded-lg"
                                        >
                                            Add Topic
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );

            const AnalyticsView = () => {
                const subjectData = SPM_SUBJECTS.map(subject => {
                    const sessions = studySessions.filter(s => s.subject === subject.id);
                    const totalMinutes = sessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                    return {
                        subject: subject.name,
                        minutes: totalMinutes,
                        color: subject.color
                    };
                });

                return (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold mb-6">Advanced Analytics</h2>
                        
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Subject Distribution */}
                            <div className="glassmorphism rounded-2xl p-6">
                                <h3 className="text-xl font-semibold mb-4">Subject Distribution</h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <PieChart>
                                        <Pie
                                            data={subjectData}
                                            dataKey="minutes"
                                            nameKey="subject"
                                            cx="50%"
                                            cy="50%"
                                            outerRadius={100}
                                            label
                                        >
                                            {subjectData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={entry.color} />
                                            ))}
                                        </Pie>
                                        <Tooltip />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>

                            {/* Study Pattern Radar */}
                            <div className="glassmorphism rounded-2xl p-6">
                                <h3 className="text-xl font-semibold mb-4">Study Pattern</h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <RadarChart data={subjectData.slice(0, 6)}>
                                        <PolarGrid stroke="#333" />
                                        <PolarAngleAxis dataKey="subject" stroke="#666" />
                                        <PolarRadiusAxis stroke="#666" />
                                        <Radar 
                                            name="Minutes" 
                                            dataKey="minutes" 
                                            stroke="#8B5CF6" 
                                            fill="#8B5CF6" 
                                            fillOpacity={0.6} 
                                        />
                                        <Tooltip />
                                    </RadarChart>
                                </ResponsiveContainer>
                            </div>

                            {/* Monthly Progress */}
                            <div className="glassmorphism rounded-2xl p-6">
                                <h3 className="text-xl font-semibold mb-4">Monthly Progress</h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <LineChart data={getMonthlyData()}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis dataKey="date" stroke="#666" />
                                        <YAxis stroke="#666" />
                                        <Tooltip 
                                            contentStyle={{ 
                                                backgroundColor: '#1a1a1a', 
                                                border: '1px solid #333' 
                                            }} 
                                        />
                                        <Line 
                                            type="monotone" 
                                            dataKey="minutes" 
                                            stroke="#8B5CF6" 
                                            strokeWidth={2}
                                            dot={{ fill: '#8B5CF6', r: 4 }}
                                        />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>

                            {/* Study Type Matrix */}
                            <div className="glassmorphism rounded-2xl p-6">
                                <h3 className="text-xl font-semibold mb-4">Weekly Heatmap</h3>
                                <div className="grid grid-cols-7 gap-2">
                                    {getHeatmapData().map((day, idx) => (
                                        <div key={idx} className="text-center">
                                            <div className="text-xs text-gray-400 mb-1">{day.label}</div>
                                            <div 
                                                className="aspect-square rounded-lg"
                                                style={{
                                                    backgroundColor: day.intensity > 0 
                                                        ? `rgba(139, 92, 246, ${day.intensity})`
                                                        : 'rgba(255, 255, 255, 0.05)'
                                                }}
                                            />
                                            <div className="text-xs mt-1">{day.minutes}m</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Stats Summary */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="glassmorphism rounded-xl p-4 text-center">
                                <div className="text-3xl font-bold text-violet-500">
                                    {studySessions.length}
                                </div>
                                <div className="text-sm text-gray-400">Total Sessions</div>
                            </div>
                            <div className="glassmorphism rounded-xl p-4 text-center">
                                <div className="text-3xl font-bold text-green-500">
                                    {Math.floor(studySessions.reduce((acc, s) => acc + s.duration, 0) / 3600)}h
                                </div>
                                <div className="text-sm text-gray-400">Total Hours</div>
                            </div>
                            <div className="glassmorphism rounded-xl p-4 text-center">
                                <div className="text-3xl font-bold text-yellow-500">
                                    {topics.length}
                                </div>
                                <div className="text-sm text-gray-400">Topics Added</div>
                            </div>
                            <div className="glassmorphism rounded-xl p-4 text-center">
                                <div className="text-3xl font-bold text-orange-500">
                                    {Math.floor(studySessions.reduce((acc, s) => acc + s.duration, 0) / studySessions.length / 60) || 0}m
                                </div>
                                <div className="text-sm text-gray-400">Avg Session</div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Helper functions for data
            const getWeeklyData = () => {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const data = days.map(day => {
                    const dayIndex = days.indexOf(day);
                    const date = new Date();
                    date.setDate(date.getDate() - date.getDay() + dayIndex);
                    const dateStr = date.toLocaleDateString();
                    const sessions = studySessions.filter(s => s.date === dateStr);
                    const minutes = sessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                    return { day, minutes };
                });
                return data;
            };

            const getMonthlyData = () => {
                const data = [];
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toLocaleDateString();
                    const sessions = studySessions.filter(s => s.date === dateStr);
                    const minutes = sessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                    data.push({
                        date: date.getDate().toString(),
                        minutes
                    });
                }
                return data;
            };

            const getHeatmapData = () => {
                const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                return days.map((label, idx) => {
                    const date = new Date();
                    date.setDate(date.getDate() - date.getDay() + idx);
                    const dateStr = date.toLocaleDateString();
                    const sessions = studySessions.filter(s => s.date === dateStr);
                    const minutes = sessions.reduce((acc, s) => acc + Math.floor(s.duration / 60), 0);
                    return {
                        label,
                        minutes,
                        intensity: Math.min(1, minutes / dailyGoal)
                    };
                });
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900">
                    {/* Header */}
                    <header className="glassmorphism border-b border-gray-800">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-8">
                                    <h1 className="text-2xl font-bold bg-gradient-to-r from-violet-500 to-purple-500 bg-clip-text text-transparent">
                                        SPM Study Tracker
                                    </h1>
                                    <nav className="flex gap-4">
                                        <button 
                                            onClick={() => setActiveView('dashboard')}
                                            className={`px-4 py-2 rounded-lg transition-colors ${
                                                activeView === 'dashboard' ? 'bg-violet-600' : 'hover:bg-gray-800'
                                            }`}
                                        >
                                            Dashboard
                                        </button>
                                        <button 
                                            onClick={() => setActiveView('spacedRepetition')}
                                            className={`px-4 py-2 rounded-lg transition-colors ${
                                                activeView === 'spacedRepetition' ? 'bg-violet-600' : 'hover:bg-gray-800'
                                            }`}
                                        >
                                            Review
                                        </button>
                                        <button 
                                            onClick={() => setActiveView('analytics')}
                                            className={`px-4 py-2 rounded-lg transition-colors ${
                                                activeView === 'analytics' ? 'bg-violet-600' : 'hover:bg-gray-800'
                                            }`}
                                        >
                                            Analytics
                                        </button>
                                    </nav>
                                </div>
                                <div className="flex items-center gap-4">
                                    <span className="text-sm text-gray-400">
                                        {new Date().toLocaleDateString('en-US', { 
                                            weekday: 'long',
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        })}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-6 py-8">
                        {activeView === 'dashboard' && <DashboardView />}
                        {activeView === 'spacedRepetition' && <SpacedRepetitionView />}
                        {activeView === 'analytics' && <AnalyticsView />}
                    </main>

                    {/* Floating Timer */}
                    {isTimerRunning && (
                        <div className="fixed bottom-6 right-6 glassmorphism rounded-2xl p-4 glow">
                            <div className="text-sm text-gray-400">Studying</div>
                            <div className="text-2xl font-mono font-bold">
                                {formatTime(timerSeconds)}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>